<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Computing polygenic scores using Stacked Clumping and Thresholding (SCT) • bigsnpr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Computing polygenic scores using Stacked Clumping and Thresholding (SCT)">
<meta property="og:description" content="bigsnpr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bigsnpr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.12.16</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Manual</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/demo.html">Quick demo</a>
    </li>
    <li>
      <a href="../articles/exo.html">Exercise</a>
    </li>
    <li>
      <a href="../articles/pruning-vs-clumping.html">Why clumping should be preferred over pruning</a>
    </li>
    <li>
      <a href="../articles/how-to-PCA.html">How to capture Population Structure with PCA (LD problem explained)</a>
    </li>
    <li>
      <a href="../articles/bedpca.html">How to capture Population Structure with PCA (directly on PLINK bed files)</a>
    </li>
    <li>
      <a href="../articles/ancestry.html">Ancestry proportions and ancestry grouping</a>
    </li>
    <li>
      <a href="../articles/SCT.html">Computing polygenic scores using Stacked Clumping and Thresholding (SCT)</a>
    </li>
    <li>
      <a href="../articles/LDpred2.html">Polygenic scores and inference using LDpred2</a>
    </li>
    <li>
      <a href="../articles/prs_uncertainty.html">Estimating uncertainty in polygenic scores using LDpred2</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://privefl.github.io/about.html" class="external-link">
    <span class="fa fa-user"></span>
     
    About
  </a>
</li>
<li>
  <a href="https://github.com/privefl/bigsnpr" class="external-link">
    <span class="fa fa-github fa"></span>
     
  </a>
</li>
<li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper-o fa"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Computing polygenic scores using Stacked
Clumping and Thresholding (SCT)</h1>
                        <h4 data-toc-skip class="author">Florian Privé
and Michael Blum</h4>
            
            <h4 data-toc-skip class="date">May 23, 2019</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/privefl/bigsnpr/blob/HEAD/vignettes/SCT.Rmd" class="external-link"><code>vignettes/SCT.Rmd</code></a></small>
      <div class="hidden name"><code>SCT.Rmd</code></div>

    </div>

    
    
<p>In this document, we show how to compute polygenic risk scores using
Stacked Clumping and Thresholding (SCT).</p>
<div class="section level2">
<h2 id="downloading-genotype-data-and-summary-statistics">Downloading genotype data and summary statistics<a class="anchor" aria-label="anchor" href="#downloading-genotype-data-and-summary-statistics"></a>
</h2>
<p>You can download <a href="https://github.com/privefl/bigsnpr/raw/master/data-raw/public-data.zip" class="external-link">data</a>
and unzip files in R. We store those files in a directory called
<code>"tmp-data"</code> here.</p>
<p>You can see <a href="https://github.com/privefl/bigsnpr/blob/master/data-raw/public-data.R" class="external-link">there</a>
how we generated these data from <a href="https://www.nature.com/articles/nature15393" class="external-link">the 1000 Genomes
project</a>. Note that these data are for educational purposes only, not
for use as a reference panel.</p>
<p>First, you need to read genotype data from the PLINK files (or BGEN
files) as well as the text file containing summary statistics.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load packages bigsnpr and bigstatsr</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://privefl.github.io/bigsnpr/" class="external-link">bigsnpr</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: bigstatsr</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read from bed/bim/fam, it generates .bk and .rds files.</span></span>
<span><span class="fu"><a href="../reference/snp_readBed.html">snp_readBed</a></span><span class="op">(</span><span class="st">"tmp-data/public-data.bed"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "C:\\Users\\au639593\\Desktop\\bigsnpr\\tmp-data\\public-data.rds"</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Attach the "bigSNP" object in R session</span></span>
<span><span class="va">obj.bigSNP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/snp_attach.html">snp_attach</a></span><span class="op">(</span><span class="st">"tmp-data/public-data.rds"</span><span class="op">)</span></span>
<span><span class="co"># See how the file looks like</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">obj.bigSNP</span>, max.level <span class="op">=</span> <span class="fl">2</span>, strict.width <span class="op">=</span> <span class="st">"cut"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 3</span></span>
<span><span class="co">##  $ genotypes:Reference class 'FBM.code256' [package "bigstatsr"] with 16 ..</span></span>
<span><span class="co">##   ..and 26 methods, of which 12 are  possibly relevant:</span></span>
<span><span class="co">##   ..  add_columns, as.FBM, bm, bm.desc, check_dimensions,</span></span>
<span><span class="co">##   ..  check_write_permissions, copy#envRefClass, initialize,</span></span>
<span><span class="co">##   ..  initialize#FBM, save, show#envRefClass, show#FBM</span></span>
<span><span class="co">##  $ fam      :'data.frame':   559 obs. of  6 variables:</span></span>
<span><span class="co">##   ..$ family.ID  : chr [1:559] "EUR_GBR" "EUR_GBR" "EUR_GBR" "EUR_GBR" ...</span></span>
<span><span class="co">##   ..$ sample.ID  : chr [1:559] "HG00096" "HG00097" "HG00099" "HG00100" ...</span></span>
<span><span class="co">##   ..$ paternal.ID: int [1:559] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##   ..$ maternal.ID: int [1:559] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##   ..$ sex        : int [1:559] 1 2 2 2 1 2 1 2 2 1 ...</span></span>
<span><span class="co">##   ..$ affection  : int [1:559] 1 2 1 1 1 1 2 1 2 1 ...</span></span>
<span><span class="co">##  $ map      :'data.frame':   130816 obs. of  6 variables:</span></span>
<span><span class="co">##   ..$ chromosome  : int [1:130816] 2 2 2 2 2 2 2 2 2 2 ...</span></span>
<span><span class="co">##   ..$ marker.ID   : chr [1:130816] "rs13400442" "rs7594567" "rs7597758" "..</span></span>
<span><span class="co">##   ..$ genetic.dist: int [1:130816] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##   ..$ physical.pos: int [1:130816] 18506 21833 22398 28228 32003 32005 36..</span></span>
<span><span class="co">##   ..$ allele1     : chr [1:130816] "C" "G" "T" "A" ...</span></span>
<span><span class="co">##   ..$ allele2     : chr [1:130816] "T" "C" "C" "G" ...</span></span>
<span><span class="co">##  - attr(*, "class")= chr "bigSNP"</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get aliases for useful slots</span></span>
<span><span class="va">G</span>   <span class="op">&lt;-</span> <span class="va">obj.bigSNP</span><span class="op">$</span><span class="va">genotypes</span></span>
<span><span class="va">CHR</span> <span class="op">&lt;-</span> <span class="va">obj.bigSNP</span><span class="op">$</span><span class="va">map</span><span class="op">$</span><span class="va">chromosome</span></span>
<span><span class="va">POS</span> <span class="op">&lt;-</span> <span class="va">obj.bigSNP</span><span class="op">$</span><span class="va">map</span><span class="op">$</span><span class="va">physical.pos</span></span>
<span><span class="va">y</span>   <span class="op">&lt;-</span> <span class="va">obj.bigSNP</span><span class="op">$</span><span class="va">fam</span><span class="op">$</span><span class="va">affection</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="va">NCORES</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bigparallelr/man/nb_cores.html" class="external-link">nb_cores</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Check some counts for the 10 first variants</span></span>
<span><span class="fu"><a href="https://privefl.github.io/bigstatsr/reference/big_counts.html" class="external-link">big_counts</a></span><span class="op">(</span><span class="va">G</span>, ind.col <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]</span></span>
<span><span class="co">## 0     504  468  421  483  476  420  380  383  478   389</span></span>
<span><span class="co">## 1      48   69  107   66   73  124  136  135   70   133</span></span>
<span><span class="co">## 2       7   22   31   10   10   15   43   41   11    37</span></span>
<span><span class="co">## &lt;NA&gt;    0    0    0    0    0    0    0    0    0     0</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read external summary statistics</span></span>
<span><span class="va">sumstats</span> <span class="op">&lt;-</span> <span class="fu">bigreadr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bigreadr/man/fread2.html" class="external-link">fread2</a></span><span class="op">(</span><span class="st">"tmp-data/public-data-sumstats.txt"</span>, </span>
<span>                             select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">sumstats</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'data.frame':    130816 obs. of  7 variables:</span></span>
<span><span class="co">##  $ chromosome  : int  2 2 2 2 2 2 2 2 2 2 ...</span></span>
<span><span class="co">##  $ marker.ID   : chr  "rs13400442" "rs7594567" "rs7597758" "rs13383216" ...</span></span>
<span><span class="co">##  $ physical.pos: int  18506 21833 22398 28228 32003 32005 36787 55237 56916 61687 ...</span></span>
<span><span class="co">##  $ allele1     : chr  "C" "G" "T" "A" ...</span></span>
<span><span class="co">##  $ allele2     : chr  "T" "C" "C" "G" ...</span></span>
<span><span class="co">##  $ beta        : num  -0.073 0.0439 -0.3325 -0.5445 -0.4881 ...</span></span>
<span><span class="co">##  $ p           : num  0.7925 0.8593 0.0846 0.028 0.0439 ...</span></span></code></pre>
<p>We split genotype data using part of the data to learn parameters of
stacking and another part of the data to evaluate statistical properties
of polygenic risk score such as AUC. Here we consider that there are 400
individuals in the training set.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">ind.train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">G</span><span class="op">)</span>, <span class="fl">400</span><span class="op">)</span></span>
<span><span class="va">ind.test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/bigparallelr/man/seq-dim.html" class="external-link">rows_along</a></span><span class="op">(</span><span class="va">G</span><span class="op">)</span>, <span class="va">ind.train</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="matching-variants-between-genotype-data-and-summary-statistics">Matching variants between genotype data and summary statistics<a class="anchor" aria-label="anchor" href="#matching-variants-between-genotype-data-and-summary-statistics"></a>
</h2>
<p>To match variants contained in genotype data and summary statistics,
the variables <code>"chr"</code> (chromosome number), <code>"pos"</code>
(genetic position), <code>"a0"</code> (reference allele) and
<code>"a1"</code> (derived allele) should be available in the summary
statistics and in the genotype data. These 4 variables are used to match
variants between the two data frames.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sumstats</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"chr"</span>, <span class="st">"rsid"</span>, <span class="st">"pos"</span>, <span class="st">"a0"</span>, <span class="st">"a1"</span>, <span class="st">"beta"</span>, <span class="st">"p"</span><span class="op">)</span></span>
<span><span class="va">map</span> <span class="op">&lt;-</span> <span class="va">obj.bigSNP</span><span class="op">$</span><span class="va">map</span><span class="op">[</span>,<span class="op">-</span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"chr"</span>, <span class="st">"pos"</span>, <span class="st">"a0"</span>, <span class="st">"a1"</span><span class="op">)</span></span>
<span><span class="va">info_snp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/snp_match.html">snp_match</a></span><span class="op">(</span><span class="va">sumstats</span>, <span class="va">map</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 130,816 variants to be matched.</span></span></code></pre>
<pre><code><span><span class="co">## 18,932 ambiguous SNPs have been removed.</span></span></code></pre>
<pre><code><span><span class="co">## Some duplicates were removed.</span></span></code></pre>
<pre><code><span><span class="co">## 111,866 variants have been matched; 0 were flipped and 0 were reversed.</span></span></code></pre>
<p>If no or few variants are actually flipped, you might want to disable
the strand flipping option. Here, these are simulated data so all
variants use the same strand and the same reference.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">info_snp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/snp_match.html">snp_match</a></span><span class="op">(</span><span class="va">sumstats</span>, <span class="va">map</span>, strand_flip <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 130,816 variants to be matched.</span></span></code></pre>
<pre><code><span><span class="co">## Some duplicates were removed.</span></span></code></pre>
<pre><code><span><span class="co">## 130,792 variants have been matched; 0 were flipped and 0 were reversed.</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># beta and lpval need to have the same length as ncol(G), CHR and POS</span></span>
<span><span class="co"># -&gt; one solution is to use missing values and use the 'exclude' parameter</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">G</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">beta</span><span class="op">[</span><span class="va">info_snp</span><span class="op">$</span><span class="va">`_NUM_ID_`</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">info_snp</span><span class="op">$</span><span class="va">beta</span></span>
<span><span class="va">lpval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">G</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">lpval</span><span class="op">[</span><span class="va">info_snp</span><span class="op">$</span><span class="va">`_NUM_ID_`</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">info_snp</span><span class="op">$</span><span class="va">p</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="computing-ct-scores-for-a-grid-of-parameters-and-chromosomes">Computing C+T scores for a grid of parameters and chromosomes<a class="anchor" aria-label="anchor" href="#computing-ct-scores-for-a-grid-of-parameters-and-chromosomes"></a>
</h2>
<div class="section level3">
<h3 id="clumping">Clumping<a class="anchor" aria-label="anchor" href="#clumping"></a>
</h3>
<p>First, the function <code><a href="../reference/SCT.html">snp_grid_clumping()</a></code> computes sets of
variants resulting from the clumping procedure that is applied
repeatedly with different values of hyper-parameters (threshold of
correlation for clumping, window size, and possibly imputation accuracy
threshold). By default, the function uses 28 (7 thresholds of
correlation x 4 window sizes) different sets of hyper-parameters for
generating sets of variants resulting from clumping.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The clumping step might take some time to complete</span></span>
<span><span class="va">all_keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SCT.html">snp_grid_clumping</a></span><span class="op">(</span><span class="va">G</span>, <span class="va">CHR</span>, <span class="va">POS</span>, ind.row <span class="op">=</span> <span class="va">ind.train</span>,</span>
<span>                              lpS <span class="op">=</span> <span class="va">lpval</span>, exclude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">lpval</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                              ncores <span class="op">=</span> <span class="va">NCORES</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">all_keep</span>, <span class="st">"grid"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     size thr.r2 grp.num thr.imp</span></span>
<span><span class="co">## 1   5000   0.01       1       1</span></span>
<span><span class="co">## 2  10000   0.01       1       1</span></span>
<span><span class="co">## 3  20000   0.01       1       1</span></span>
<span><span class="co">## 4  50000   0.01       1       1</span></span>
<span><span class="co">## 5   1000   0.05       1       1</span></span>
<span><span class="co">## 6   2000   0.05       1       1</span></span>
<span><span class="co">## 7   4000   0.05       1       1</span></span>
<span><span class="co">## 8  10000   0.05       1       1</span></span>
<span><span class="co">## 9    500   0.10       1       1</span></span>
<span><span class="co">## 10  1000   0.10       1       1</span></span>
<span><span class="co">## 11  2000   0.10       1       1</span></span>
<span><span class="co">## 12  5000   0.10       1       1</span></span>
<span><span class="co">## 13   250   0.20       1       1</span></span>
<span><span class="co">## 14   500   0.20       1       1</span></span>
<span><span class="co">## 15  1000   0.20       1       1</span></span>
<span><span class="co">## 16  2500   0.20       1       1</span></span>
<span><span class="co">## 17   100   0.50       1       1</span></span>
<span><span class="co">## 18   200   0.50       1       1</span></span>
<span><span class="co">## 19   400   0.50       1       1</span></span>
<span><span class="co">## 20  1000   0.50       1       1</span></span>
<span><span class="co">## 21    62   0.80       1       1</span></span>
<span><span class="co">## 22   125   0.80       1       1</span></span>
<span><span class="co">## 23   250   0.80       1       1</span></span>
<span><span class="co">## 24   625   0.80       1       1</span></span>
<span><span class="co">## 25    52   0.95       1       1</span></span>
<span><span class="co">## 26   105   0.95       1       1</span></span>
<span><span class="co">## 27   210   0.95       1       1</span></span>
<span><span class="co">## 28   526   0.95       1       1</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="thresholding">Thresholding<a class="anchor" aria-label="anchor" href="#thresholding"></a>
</h3>
<p>Then, for each chromosome, for each set of variants resulting from
clumping and for each p-value threshold, the function
<code><a href="../reference/SCT.html">snp_grid_PRS()</a></code> computes C+T scores.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multi_PRS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SCT.html">snp_grid_PRS</a></span><span class="op">(</span><span class="va">G</span>, <span class="va">all_keep</span>, <span class="va">beta</span>, <span class="va">lpval</span>, ind.row <span class="op">=</span> <span class="va">ind.train</span>,</span>
<span>                          backingfile <span class="op">=</span> <span class="st">"tmp-data/public-data-scores"</span>, </span>
<span>                          n_thr_lpS <span class="op">=</span> <span class="fl">50</span>, ncores <span class="op">=</span> <span class="va">NCORES</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">multi_PRS</span><span class="op">)</span>  <span class="co">## 4200 C+T scores for 400 individuals</span></span></code></pre></div>
<pre><code><span><span class="co">## [1]  400 4200</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="stacking-ct-predictions">Stacking C+T predictions<a class="anchor" aria-label="anchor" href="#stacking-ct-predictions"></a>
</h2>
<p>A penalized regression is finally used to learn an optimal linear
combination of C+T scores.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">final_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SCT.html">snp_grid_stacking</a></span><span class="op">(</span><span class="va">multi_PRS</span>, <span class="va">y</span><span class="op">[</span><span class="va">ind.train</span><span class="op">]</span>, ncores <span class="op">=</span> <span class="va">NCORES</span>, K <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">final_mod</span><span class="op">$</span><span class="va">mod</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 9</span></span></span>
<span><span class="co">##    alpha power_adaptive power_scale validation_loss intercept beta   nb_var</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 0.000<span style="text-decoration: underline;">1</span>              0           1           0.565     -<span style="color: #BB0000;">1.05</span> <span style="color: #949494;">&lt;dbl&gt;</span>    <span style="text-decoration: underline;">4</span>028</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 0.01                0           1           0.567     -<span style="color: #BB0000;">1.06</span> <span style="color: #949494;">&lt;dbl&gt;</span>     808</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> 1                   0           1           0.569     -<span style="color: #BB0000;">1.09</span> <span style="color: #949494;">&lt;dbl&gt;</span>     136</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 2 more variables: message &lt;list&gt;, all_conv &lt;lgl&gt;</span></span></span></code></pre>
<p>Here, I use <code>K = 4</code> folds because this example data is
very small; the default is to use <code>10</code>. For options for
fitting penalized regressions, see <a href="https://privefl.github.io/bigstatsr/articles/penalized-regressions.html" class="external-link">this
vignette</a>.</p>
<p>From stacking C+T scores, we can derive a unique vector of weights
and compare effects resulting from stacking to the initial regression
coefficients provided as summary statistics.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_beta</span> <span class="op">&lt;-</span> <span class="va">final_mod</span><span class="op">$</span><span class="va">beta.G</span></span>
<span><span class="va">ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">new_beta</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: package 'ggplot2' was built under R version 4.2.3</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">new_beta</span>, x <span class="op">=</span> <span class="va">beta</span><span class="op">)</span><span class="op">[</span><span class="va">ind</span>, <span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, intercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">0</span>, intercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://privefl.github.io/bigstatsr/reference/theme_bigstatsr.html" class="external-link">theme_bigstatsr</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Effect sizes from GWAS"</span>, y <span class="op">=</span> <span class="st">"Non-zero effect sizes from SCT"</span><span class="op">)</span></span></code></pre></div>
<p><img src="SCT_files/figure-html/unnamed-chunk-11-1.png" width="700" style="display: block; margin: auto;"></p>
<p>We can use this vector of variant weights to compute polygenic risk
scores on the test set and evaluate the Area Under the Curve (AUC).</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="va">final_mod</span><span class="op">$</span><span class="va">intercept</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://privefl.github.io/bigstatsr/reference/big_prodVec.html" class="external-link">big_prodVec</a></span><span class="op">(</span><span class="va">G</span>, <span class="va">new_beta</span><span class="op">[</span><span class="va">ind</span><span class="op">]</span>, ind.row <span class="op">=</span> <span class="va">ind.test</span>, ind.col <span class="op">=</span> <span class="va">ind</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://privefl.github.io/bigstatsr/reference/AUC.html" class="external-link">AUCBoot</a></span><span class="op">(</span><span class="va">pred</span>, <span class="va">y</span><span class="op">[</span><span class="va">ind.test</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      Mean      2.5%     97.5%        Sd </span></span>
<span><span class="co">## 0.6829444 0.5847917 0.7756834 0.0486900</span></span></code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Phenotype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">ind.test</span><span class="op">]</span>, levels <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="st">"Case"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Probability <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">pred</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://privefl.github.io/bigstatsr/reference/theme_bigstatsr.html" class="external-link">theme_bigstatsr</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">Probability</span>, fill <span class="op">=</span> <span class="va">Phenotype</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span></code></pre></div>
<p><img src="SCT_files/figure-html/unnamed-chunk-13-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="best-ct-predictions">Best C+T predictions<a class="anchor" aria-label="anchor" href="#best-ct-predictions"></a>
</h2>
<p>Instead of stacking, an alternative is to choose the best C+T score
based on the computed grid. This procedure is appealing when there are
not enough individuals to learn the stacking weights.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: package 'dplyr' was built under R version 4.2.3</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">all_keep</span>, <span class="st">"grid"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>thr.lp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">multi_PRS</span>, <span class="st">"grid.lpS.thr"</span><span class="op">)</span><span class="op">)</span>, id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="st">"thr.lp"</span><span class="op">)</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">grid2</span><span class="op">)</span></span>
<span><span class="va">grid2</span><span class="op">$</span><span class="va">auc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://privefl.github.io/bigstatsr/reference/big_apply.html" class="external-link">big_apply</a></span><span class="op">(</span><span class="va">multi_PRS</span>, a.FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span>, <span class="va">ind</span>, <span class="va">s</span>, <span class="va">y.train</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Sum over all chromosomes, for the same C+T parameters</span></span>
<span>  <span class="va">single_PRS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>, <span class="va">ind</span> <span class="op">+</span> <span class="va">s</span> <span class="op">*</span> <span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>  <span class="co">## replace by 0:21 in real data</span></span>
<span>  <span class="fu">bigstatsr</span><span class="fu">::</span><span class="fu"><a href="https://privefl.github.io/bigstatsr/reference/AUC.html" class="external-link">AUC</a></span><span class="op">(</span><span class="va">single_PRS</span>, <span class="va">y.train</span><span class="op">)</span></span>
<span><span class="op">}</span>, ind <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">s</span>, s <span class="op">=</span> <span class="va">s</span>, y.train <span class="op">=</span> <span class="va">y</span><span class="op">[</span><span class="va">ind.train</span><span class="op">]</span>,</span>
<span>a.combine <span class="op">=</span> <span class="st">'c'</span>, block.size <span class="op">=</span> <span class="fl">1</span>, ncores <span class="op">=</span> <span class="va">NCORES</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">max_prs</span> <span class="op">&lt;-</span> <span class="va">grid2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">auc</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 10 × 7</span></span></span>
<span><span class="co">##     size thr.r2 grp.num thr.imp thr.lp    id   auc</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">4</span>000   0.05       1       1  1.63      7 0.651</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> <span style="text-decoration: underline;">10</span>000   0.05       1       1  0.733     8 0.651</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> <span style="text-decoration: underline;">10</span>000   0.05       1       1  1.63      8 0.651</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> <span style="text-decoration: underline;">10</span>000   0.05       1       1  0.455     8 0.650</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">5</span>000   0.1        1       1  0.733    12 0.650</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> <span style="text-decoration: underline;">10</span>000   0.05       1       1  0.492     8 0.650</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> <span style="text-decoration: underline;">10</span>000   0.05       1       1  0.127     8 0.650</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">4</span>000   0.05       1       1  1.01      7 0.650</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> <span style="text-decoration: underline;">10</span>000   0.05       1       1  0.149     8 0.650</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> <span style="text-decoration: underline;">10</span>000   0.05       1       1  0.533     8 0.650</span></span></code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ind.keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">all_keep</span>, <span class="va">max_prs</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">lpval</span><span class="op">[</span><span class="va">ind.keep</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">max_prs</span><span class="op">$</span><span class="va">thr.lp</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1098</span></span></code></pre>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://privefl.github.io/bigstatsr/reference/AUC.html" class="external-link">AUCBoot</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/snp_PRS.html">snp_PRS</a></span><span class="op">(</span><span class="va">G</span>, <span class="va">beta</span><span class="op">[</span><span class="va">ind.keep</span><span class="op">]</span>, ind.test <span class="op">=</span> <span class="va">ind.test</span>, ind.keep <span class="op">=</span> <span class="va">ind.keep</span>,</span>
<span>          lpS.keep <span class="op">=</span> <span class="va">lpval</span><span class="op">[</span><span class="va">ind.keep</span><span class="op">]</span>, thr.list <span class="op">=</span> <span class="va">max_prs</span><span class="op">$</span><span class="va">thr.lp</span><span class="op">)</span>,</span>
<span>  <span class="va">y</span><span class="op">[</span><span class="va">ind.test</span><span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      Mean      2.5%     97.5%        Sd </span></span>
<span><span class="co">## 0.6779916 0.5814000 0.7691177 0.0477630</span></span></code></pre>
<p>For this example, the best C+T predictions provides an AUC of 67%
whereas stacking, which should be preferred, provides an AUC of
68.5%.</p>
<div class="section level3">
<h3 id="reference">Reference<a class="anchor" aria-label="anchor" href="#reference"></a>
</h3>
<p>Privé, Florian, et al. <a href="https://doi.org/10.1016/j.ajhg.2019.11.001" class="external-link">“Making the most of
Clumping and Thresholding for polygenic scores.”</a> Am J Hum Genet
(2019).</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Florian Privé.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
